<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.app.inv.mapper.InventoryMapper">
	<select id="loadInventoryActive" resultType = "com.app.inv.model.InventoryActive">
		SELECT
		III.item_number as itemNumber,
		CONCAT(IIC.brand, " ", IIC.name) as name,
		III.code_ingredient as codeIngredient,
		III.quantity as quantity,
		III.unit_price as unitPrice,
		CU.name as unit,
		III.code_unit as unitCode,
		III.stock_date as stockDate,
		III.roast_date as roastDate,
		III.exp_date as expDate,
		III.remarks as comment
		FROM

		im_ingredient_inventory III
		JOIN
		im_ingredient_code IIC
		ON
		III.code_ingredient = IIC.code

		JOIN
		core_units CU
		ON
		III.code_unit = CU.code_unit


	</select>
	
	<select id = "loadInventoryPending" resultType="com.app.inv.model.InventoryPending">
        SELECT 
        IIP.item_number as itemNumber,
        CONCAT(IIC.brand, " ", IIC.name) as name,
        IIP.code_ingredient as codeIngredient,
        IIP.quantity,
        IIP.unit_price as unitPrice,
        CU.name as unit,
        IIP.code_unit as unitCode,
        IIP.total_price as totalPrice,
        IIP.order_date as orderDate 
        FROM 
        im_ingredient_pending IIP 
        JOIN
        im_ingredient_code IIC 
        ON IIP.code_ingredient = IIC.code 
      
        JOIN core_units CU 
        ON 
        IIP.code_unit = CU.code_unit
      
    </select>
    
    <insert id = "saveInventoryPending" parameterType="com.app.inv.model.Inventory">
        insert into 
        im_ingredient_pending(
        create_date, 
        update_date, 
        update_user, 
        update_program, 
        code_ingredient, 
        quantity, 
        unit_price, 
        code_unit, 
        total_price, 
        order_date) 
        values (
        sysdate(), 
        sysdate(), 
        "pgm", 
        "IPService", 
        #{codeIngredient}, 
        #{quantity}, 
        #{unitPrice}, 
        #{unitCode},
        #{totalPrice}, 
        sysdate())
    </insert>
    
    <delete id="deleteInventoryPending" parameterType="_long">
        delete from 
        im_ingredient_pending 
        where 
        item_number = #{index}
    </delete>
    
    <insert id="saveToInventory" parameterType="com.app.inv.model.Inventory">
        insert into 
        im_ingredient_inventory(
        create_date, 
        update_date, 
        update_user, 
        update_program, 
        code_ingredient, 
        quantity, 
        total_price, 
        code_unit, 
        unit_price, 
        stock_date, 
        roast_date,
        exp_date,
        remarks) 
        values (
        sysdate(), 
        sysdate(), 
        "pgm", 
        "IPService", 
        #{codeIngredient}, 
        #{quantity},
        #{totalPrice},
        #{unitCode}, 
        #{unitPrice}, 
        sysdate(), 
        #{roastDate},
        #{expDate},
        #{comment})
    </insert>
    
    <insert id="addPendingHist" parameterType="com.app.inv.model.Inventory">
        
        insert into 
        im_ingredient_pending_hist(
        create_date,
        update_date,
        update_user, 
        update_program,
        code_ingredient,
        quantity,
        unit_price, 
        code_unit, 
        total_price, 
        order_date, 
        delivery_date) 
        values (
        sysdate(),
        sysdate(), 
        "pgm", 
        "IPService", 
        #{codeIngredient}, 
        #{quantity}, 
        #{unitPrice}, 
        #{unitCode}, 
        #{totalPrice}, 
        #{date},
        sysdate())
    </insert>
    
    <delete id="deleteInventory" parameterType="_long">
        delete from 
        im_ingredient_inventory 
        where 
        item_number = #{index}
    </delete>
    
    <update id="updateInventory" parameterType="map">
        update 
        im_ingredient_inventory
        SET 
        update_date = sysdate(), 
        update_user = "pgm", 
        update_program = "IPService", 
        quantity = #{param2} 
        where 
        item_number = #{param1}
        
    </update>  
</mapper>